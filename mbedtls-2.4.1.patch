diff --git a/include/mbedtls/config.h b/include/mbedtls/config.h
index 6fc9c77..19e83b5 100644
--- a/include/mbedtls/config.h
+++ b/include/mbedtls/config.h
@@ -113,7 +113,7 @@
  *
  * Enable this layer to allow use of alternative memory allocators.
  */
-//#define MBEDTLS_PLATFORM_MEMORY
+#define MBEDTLS_PLATFORM_MEMORY
 
 /**
  * \def MBEDTLS_PLATFORM_NO_STD_FUNCTIONS
diff --git a/library/asn1write.c b/library/asn1write.c
index 69b61b2..b4d3ad6 100644
--- a/library/asn1write.c
+++ b/library/asn1write.c
@@ -272,6 +272,21 @@ int mbedtls_asn1_write_printable_string( unsigned char **p, unsigned char *start
     return( (int) len );
 }
 
+int mbedtls_asn1_write_utf8_string( unsigned char **p, unsigned char *start,
+                                 const char *text, size_t text_len )
+{
+    int ret;
+    size_t len = 0;
+
+    MBEDTLS_ASN1_CHK_ADD( len, mbedtls_asn1_write_raw_buffer( p, start,
+                  (const unsigned char *) text, text_len ) );
+
+    MBEDTLS_ASN1_CHK_ADD( len, mbedtls_asn1_write_len( p, start, len ) );
+    MBEDTLS_ASN1_CHK_ADD( len, mbedtls_asn1_write_tag( p, start, MBEDTLS_ASN1_UTF8_STRING ) );
+
+    return( (int) len );
+}
+
 int mbedtls_asn1_write_ia5_string( unsigned char **p, unsigned char *start,
                            const char *text, size_t text_len )
 {
diff --git a/library/x509_create.c b/library/x509_create.c
index df20ec8..3f03cb8 100644
--- a/library/x509_create.c
+++ b/library/x509_create.c
@@ -180,6 +180,9 @@ int mbedtls_x509_set_extension( mbedtls_asn1_named_data **head, const char *oid,
     return( 0 );
 }
 
+int mbedtls_asn1_write_utf8_string( unsigned char **p, unsigned char *start,
+                                 const char *text, size_t text_len );
+
 /*
  *  RelativeDistinguishedName ::=
  *    SET OF AttributeTypeAndValue
@@ -207,10 +210,15 @@ static int x509_write_name( unsigned char **p, unsigned char *start,
         MBEDTLS_ASN1_CHK_ADD( len, mbedtls_asn1_write_ia5_string( p, start,
                                                   (const char *) name,
                                                   name_len ) );
+    } else if( MBEDTLS_OID_SIZE( MBEDTLS_OID_AT_COUNTRY ) == oid_len &&
+            memcmp( oid, MBEDTLS_OID_AT_COUNTRY, oid_len) == 0) {
+        MBEDTLS_ASN1_CHK_ADD( len, mbedtls_asn1_write_printable_string( p, start,
+                                                        (const char *) name,
+                                                        name_len ) );
     }
     else
     {
-        MBEDTLS_ASN1_CHK_ADD( len, mbedtls_asn1_write_printable_string( p, start,
+        MBEDTLS_ASN1_CHK_ADD( len, mbedtls_asn1_write_utf8_string( p, start,
                                                         (const char *) name,
                                                         name_len ) );
     }
